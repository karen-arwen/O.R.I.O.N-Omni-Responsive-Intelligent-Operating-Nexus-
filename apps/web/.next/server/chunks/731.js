"use strict";exports.id=731,exports.ids=[731],exports.modules={1813:(e,t,a)=>{a.d(t,{IA:()=>fetchHealth,Sk:()=>fetchSnapshot,kh:()=>fetchTimeline,m4:()=>fetchTrust,nz:()=>fetchTrustDomain,qr:()=>postFeedback});var s=a(5516);let r=process.env.NEXT_PUBLIC_ORION_API_BASE_URL??"http://127.0.0.1:3000";let ApiError=class ApiError extends Error{constructor(e){super(e.message),this.status=e.status,this.code=e.code,this.details=e.details,this.requestId=e.requestId}};let apiFetch=async(e,t)=>{let a;let n=`${r??""}${e}`,i=(0,s.u)(),o={"Content-Type":"application/json"};i.tenantId&&(o["x-tenant-id"]=i.tenantId),i.token&&(o.Authorization=`Bearer ${i.token}`);try{a=await fetch(n,{...t,headers:{...o,...t?.headers??{}}})}catch(e){throw new ApiError({status:0,code:"network_error",message:"Falha de rede ao chamar API",details:e})}if(!a.ok&&304!==a.status){let e=null;try{e=await a.json()}catch{}let t=e?.error;throw new ApiError({status:a.status,code:t?.code??"api_error",message:t?.message??`API error ${a.status}`,details:t?.details,requestId:t?.requestId})}return a};var n=a(8207);let i=n.Ry({id:n.Z_(),type:n.Z_(),timestamp:n.Z_(),decisionId:n.Z_().nullable().optional(),correlationId:n.Z_().nullable().optional(),domain:n.Z_(),kind:n.Km(["decision","trust","system","audit","other"]),summary:n.Z_(),payload:n.IM(n.Yj())}),o=n.Ry({items:n.IX(i),nextCursor:n.Z_().nullable(),capabilities:n.Ry({canExecute:n.O7(),v:n.Z_()})}),l=n.Ry({scoresByDomain:n.IM(n.Rx()),defaultsByDomain:n.IM(n.Rx()),deltas:n.Ry({accept:n.Rx(),reject:n.Rx(),implicitRepeatNoAction:n.Rx()}),lastUpdatedByDomain:n.IM(n.Z_()).optional(),capabilities:n.Ry({canExecute:n.O7(),v:n.Z_()})}),u=n.Ry({decisionId:n.Z_().optional(),correlationId:n.Z_().optional(),snapshot:n.IM(n.Yj()),events:n.IX(n.Ry({id:n.Z_(),type:n.Z_(),timestamp:n.Z_()})),capabilities:n.Ry({canExecute:n.O7(),v:n.Z_()}),etag:n.Z_().optional()}),fetchHealth=async()=>{let e=await apiFetch("/health"),t=await e.json();return n.Ry({status:n.Z_(),uptime:n.Rx(),version:n.Z_().optional(),timestamp:n.Z_()}).parse(t)},fetchTimeline=async e=>{let t=new URLSearchParams;Object.entries(e).forEach(([e,a])=>{null!=a&&""!==a&&t.append(e,String(a))});let a=await apiFetch(`/timeline?${t.toString()}`),s=await a.json();return o.parse(s)},fetchTrust=async()=>{let e=await apiFetch("/trust"),t=await e.json();return l.parse(t)},fetchTrustDomain=async e=>{let t=await apiFetch(`/trust/${e}`),a=await t.json();return n.Ry({domain:n.Z_(),score:n.Rx(),fromDefault:n.O7(),capabilities:n.Ry({canExecute:n.O7(),v:n.Z_()})}).parse(a)},fetchSnapshot=async(e,t)=>{let a=await apiFetch(`/decisions/${e}/snapshot`,{headers:t?{"If-None-Match":t}:void 0});if(304===a.status)return{fromCache:!0,etag:t};let s=await a.json();return{fromCache:!1,...u.parse(s)}},postFeedback=async({decisionId:e,accepted:t,rejected:a})=>{let s=await apiFetch(`/decisions/${e}/feedback`,{method:"POST",body:JSON.stringify({accepted:t,rejected:a})}),r=await s.json();return n.Ry({decisionId:n.Z_(),domain:n.Z_(),trust:n.Ry({oldScore:n.Rx(),newScore:n.Rx()}).optional(),feedback:n.Km(["accepted","rejected"]),capabilities:n.Ry({canExecute:n.O7(),v:n.Z_()})}).parse(r)}},3756:(e,t,a)=>{a.d(t,{UE:()=>useApiHealth,Ho:()=>useFeedbackMutation,RK:()=>useSnapshot,mU:()=>useTimeline,gV:()=>useTrust,HW:()=>useTrustDomain});var s=a(8806),r=a(2873),n=a(7200),i=a(487),o=a(1813);let l={timeline:e=>["timeline",e],trust:["trust"],trustDomain:e=>["trust",e],snapshot:e=>["snapshot",e],health:["health"]},u={},recordLatency=(e,t)=>{let a=u[e]??{name:e,value:0,count:0};a.value=a.value+(t-a.value)/(a.count+1),a.count+=1,u[e]=a};var c=a(8726);let useTimeline=e=>(0,s.N)({queryKey:l.timeline(e),queryFn:async({pageParam:t})=>{let a=performance.now(),s=await (0,o.kh)({...e,cursor:t});return recordLatency("timeline",performance.now()-a),s},getNextPageParam:e=>e.nextCursor??void 0,enabled:!!(e.correlationId||e.decisionId||e.domain||e.types||e.from||e.to),staleTime:15e3}),useTrust=()=>(0,r.a)({queryKey:l.trust,queryFn:o.m4,staleTime:3e4}),useTrustDomain=e=>(0,r.a)({queryKey:l.trustDomain(e),queryFn:()=>(0,o.nz)(e),staleTime:3e4,enabled:!!e}),useHealth=()=>(0,r.a)({queryKey:l.health,queryFn:o.IA,refetchInterval:15e3,retry:1}),useSnapshot=e=>{let t=(0,n.NL)();return(0,r.a)({queryKey:l.snapshot(e),queryFn:async({queryKey:a})=>{let s=t.getQueryData(a);return(0,o.Sk)(e,s?.etag)},staleTime:6e4,enabled:!!e})},useFeedbackMutation=()=>{let e=(0,n.NL)();return(0,i.D)({mutationFn:o.qr,onSuccess:()=>{e.invalidateQueries({queryKey:l.trust})}})},useApiHealth=()=>{let e=(0,n.NL)(),t=useHealth(),a=(0,c.useCallback)(()=>(e.invalidateQueries(),t.refetch()),[t,e]);return{health:t,retryAll:a}}},5516:(e,t,a)=>{a.d(t,{S:()=>saveAuthSettings,u:()=>loadAuthSettings});let s="orion-auth-settings",r={tenantId:"local",roles:["admin"]},n=r,loadAuthSettings=()=>{let e="undefined"!=typeof localStorage;if(!e)return n;try{let e=localStorage.getItem(s);if(!e)return n;let t=JSON.parse(e);return n={...r,...t,roles:t.roles??r.roles}}catch{return n}},saveAuthSettings=e=>{n={...r,...e,roles:e.roles??r.roles},"undefined"!=typeof localStorage&&localStorage.setItem(s,JSON.stringify(n))}}};