(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[710],{670:function(e,t,r){Promise.resolve().then(r.bind(r,9224))},9224:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return MissionPage}});var s=r(7573),n=r(5025),i=r(6141),a=r(2389),o=r(7653),c=r(6907),l=r(9975),d=r(2182);function MissionPage(){let{live:e,toggleLive:t}=(0,a.C)(),[r,u]=(0,o.useState)(!0),m=(0,i.mU)({limit:50,from:new Date(Date.now()-36e5).toISOString()}),x=(0,o.useMemo)(()=>{var e,t;return null!==(t=null===(e=m.data)||void 0===e?void 0:e.pages.flatMap(e=>e.items))&&void 0!==t?t:[]},[m.data]),h=(0,i.gV)();return(0,s.jsx)(n.Z,{children:(0,s.jsx)(d.s,{roles:["member","admin"],children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"Mission Mode"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Live command center"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"rounded-lg bg-primary text-primary-foreground px-3 py-2 text-sm",onClick:t,children:e?"Pause Live":"Resume Live"}),(0,s.jsx)("button",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2 text-sm",onClick:()=>m.refetch(),children:"Jump to Live"}),(0,s.jsxs)("label",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[(0,s.jsx)("input",{type:"checkbox",checked:r,onChange:e=>u(e.target.checked)}),"Auto-pause on scroll"]})]})]}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"lg:col-span-2",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold mb-2",children:"Live Timeline"}),(0,s.jsx)(c.j,{items:x,onLoadMore:()=>m.fetchNextPage(),hasNext:!!m.hasNextPage,filters:{}})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(l.S,{}),(0,s.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold mb-2",children:"Trust Radar"}),(0,s.jsx)("div",{className:"space-y-2 text-sm",children:h.data?Object.entries(h.data.scoresByDomain).map(e=>{let[t,r]=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:r<.4?"text-red-300":"text-emerald-200",children:r.toFixed(2)})]},t)}):"Carregando..."})]})]})]})]})})})}},9975:function(e,t,r){"use strict";r.d(t,{S:function(){return AlertsPanel}});var s=r(7573),n=r(2056),i=r.n(n),a=r(6141),o=r(5562),c=r(10);function AlertsPanel(){var e,t;let r=(0,a.gV)(),n=(0,a.mU)({from:(function(e,t){let r=+(0,o.Q)(e);return(0,c.L)(e,r+-864e5)})(new Date,-864e5).toISOString(),limit:100}),l=[];r.data&&Object.entries(r.data.scoresByDomain).forEach(e=>{let[t,r]=e;r<.4&&l.push({severity:"critical",message:"Trust baixo em ".concat(t," (").concat(r.toFixed(2),")"),ctaLabel:"Ver trust",ctaHref:"/trust/".concat(t)})});let d=null!==(t=null===(e=n.data)||void 0===e?void 0:e.pages.flatMap(e=>e.items))&&void 0!==t?t:[];return(d.forEach(e=>{var t,r;"permission.decision"===e.type&&"deny"===e.payload.permissionLevel&&l.push({severity:"warn",message:"Permission deny recente",ctaLabel:"Ver timeline filtrada",ctaHref:"/timeline?correlationId=".concat(null!==(t=e.correlationId)&&void 0!==t?t:"")}),"system.no_action"===e.type&&l.push({severity:"info",message:"Sil\xeancio repetido detectado",ctaLabel:"Ver fluxo",ctaHref:"/timeline?correlationId=".concat(null!==(r=e.correlationId)&&void 0!==r?r:"")})}),0===l.length)?(0,s.jsx)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-sm text-muted-foreground",children:"Nenhum alerta ativo."}):(0,s.jsxs)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",children:"Alertas"}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:[l.length," ativos"]})]}),(0,s.jsx)("div",{className:"space-y-2",children:l.map((e,t)=>(0,s.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 px-3 py-2 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm",children:e.message}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.severity})]}),(0,s.jsx)(i(),{className:"text-xs text-primary underline",href:e.ctaHref,children:e.ctaLabel})]},t))})]})}},2182:function(e,t,r){"use strict";r.d(t,{s:function(){return AccessGuard}});var s=r(7573),n=r(7653),i=r(8116);function AccessGuard(e){let{roles:t,children:r}=e,[a,o]=(0,n.useState)(!1),[c,l]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{var e;let r=(0,i.u)(),s=(null!==(e=r.roles)&&void 0!==e?e:[]).map(e=>e.toLowerCase()),n=t.map(e=>e.toLowerCase());o(n.some(e=>s.includes(e))),l(!0)},[t]),c)?a?(0,s.jsx)(s.Fragment,{children:r}):(0,s.jsx)("div",{className:"p-6 text-center text-sm text-muted-foreground",children:"Access denied"}):null}},6907:function(e,t,r){"use strict";r.d(t,{j:function(){return TimelineList}});var s=r(7573),n=r(7653),i=r(2e3),a=r(6473);function TimelineList(e){let{items:t,onLoadMore:r,hasNext:a,filters:o}=e,c=(0,n.useRef)(null),l=(0,i.MG)({count:a?t.length+1:t.length,getScrollElement:()=>c.current,estimateSize:()=>96}),d=l.getVirtualItems();(0,n.useEffect)(()=>{let e=d[d.length-1];e&&e.index>=t.length-1&&a&&r()},[d,t.length,a,r]);let u=l.getVirtualItems();return(0,s.jsx)("div",{ref:c,"data-testid":"timeline-scroll",className:"h-[70vh] overflow-auto rounded-xl border border-white/10 bg-white/5",children:(0,s.jsx)("div",{style:{height:l.getTotalSize(),width:"100%",position:"relative"},children:u.map(e=>{let r=e.index>t.length-1,n=t[e.index];return(0,s.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:"translateY(".concat(e.start,"px)")},className:"px-3 py-2",children:r?(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Carregando..."}):(0,s.jsx)(TimelineCard,{item:n,filters:o})},e.key)})})})}let TimelineCard=e=>{let{item:t,filters:r}=e,copy=e=>e&&navigator.clipboard.writeText(e);return(0,s.jsxs)("article",{className:"rounded-lg border border-white/10 bg-white/5 p-4 flex items-start justify-between gap-3 hover:border-primary/40 transition",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:t.summary}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[t.kind," > ",t.domain," > ",new Date(t.timestamp).toLocaleString()]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground items-end",children:[(0,s.jsx)("button",{onClick:()=>{var e;return copy(null!==(e=t.decisionId)&&void 0!==e?e:"")},className:"hover:text-foreground",children:"copy decision"}),(0,s.jsx)("button",{onClick:()=>{var e;return copy(null!==(e=t.correlationId)&&void 0!==e?e:"")},className:"hover:text-foreground",children:"copy correlation"}),(0,s.jsx)("button",{onClick:()=>{var e,s;return(0,a.J)({decisionId:null!==(e=t.decisionId)&&void 0!==e?e:void 0,correlationId:null!==(s=t.correlationId)&&void 0!==s?s:void 0,filters:r,items:[t]})},className:"hover:text-foreground",children:"export trace"})]})]})}},6473:function(e,t,r){"use strict";r.d(t,{J:function(){return exportTrace}});let exportTrace=e=>{let{decisionId:t,correlationId:r,filters:s,items:n,snapshot:i}=e,a={metadata:{exportedAt:new Date().toISOString(),decisionId:t,correlationId:r,filters:s,appVersion:"v0"},items:n,snapshot:i},o=t?"orion-trace-decision-".concat(t,".json"):r?"orion-trace-corr-".concat(r,".json"):"orion-trace-".concat(Date.now(),".json"),c=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(c),d=document.createElement("a");d.href=l,d.download=o,d.click(),URL.revokeObjectURL(l)}},10:function(e,t,r){"use strict";function constructFrom(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}r.d(t,{L:function(){return constructFrom}})},5562:function(e,t,r){"use strict";function toDate(e){let t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?e:NaN)}r.d(t,{Q:function(){return toDate}})}},function(e){e.O(0,[274,54,447,786,529,0,25,293,53,744],function(){return e(e.s=670)}),_N_E=e.O()}]);