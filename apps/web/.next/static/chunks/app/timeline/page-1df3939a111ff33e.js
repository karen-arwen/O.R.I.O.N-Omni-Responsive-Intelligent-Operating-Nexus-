(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[571],{7285:function(e,t,r){Promise.resolve().then(r.bind(r,3205))},3205:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return TimelinePage}});var i=r(7573),n=r(7653),o=r(6141),a=r(8673);let l=a.Ry({name:a.Z_().min(1),filters:a.Ry({correlationId:a.Z_().optional(),decisionId:a.Z_().optional(),domain:a.Z_().optional(),kind:a.Z_().optional(),types:a.Z_().optional(),from:a.Z_().optional(),to:a.Z_().optional()}),favorite:a.O7().optional(),createdAt:a.Z_().optional()}),s="orion-saved-views",d=[],loadSavedViews=()=>{if("undefined"==typeof localStorage)return d;let e=localStorage.getItem(s);if(!e)return[];try{let t=JSON.parse(e),r=a.IX(l).safeParse(t),i=r.success?r.data:[];return d=i,i}catch(e){return d}},saveViews=e=>{d=e,"undefined"!=typeof localStorage&&localStorage.setItem(s,JSON.stringify(e))},addSavedView=e=>{var t;let r=loadSavedViews();saveViews([{...e,createdAt:null!==(t=e.createdAt)&&void 0!==t?t:new Date().toISOString()},...r])};var c=r(5390),u=r(4806);let m=a.Ry({correlationId:a.Z_().optional(),decisionId:a.Z_().optional(),domain:a.Z_().optional(),kind:a.Z_().optional(),types:a.Z_().optional(),from:a.Z_().optional(),to:a.Z_().optional()});function TimelineFilters(e){var t;let{value:r,onChange:o}=e,[a,l]=(0,n.useState)(()=>loadSavedViews()),[s,d]=(0,n.useState)(""),applyView=e=>{o(e.filters)};return(0,i.jsxs)(u.Zb,{className:"p-4 space-y-3 sticky top-16 z-20",children:[(0,i.jsxs)("div",{className:"grid sm:grid-cols-3 lg:grid-cols-4 gap-2",children:[["correlationId","decisionId","domain","types","from","to"].map(e=>{var t;return(0,i.jsx)("input",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2 text-sm",placeholder:e,value:null!==(t=r[e])&&void 0!==t?t:"",onChange:t=>o({...r,[e]:t.target.value})},e)}),(0,i.jsxs)("select",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2 text-sm",value:null!==(t=r.kind)&&void 0!==t?t:"",onChange:e=>o({...r,kind:e.target.value}),children:[(0,i.jsx)("option",{value:"",children:"kind"}),(0,i.jsx)("option",{value:"decision",children:"decision"}),(0,i.jsx)("option",{value:"trust",children:"trust"}),(0,i.jsx)("option",{value:"system",children:"system"}),(0,i.jsx)("option",{value:"audit",children:"audit"}),(0,i.jsx)("option",{value:"other",children:"other"})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(c.z,{size:"sm",onClick:()=>o({...r}),children:"Apply"}),(0,i.jsx)(c.z,{variant:"secondary",size:"sm",onClick:()=>o({}),children:"Reset"})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("input",{className:"rounded-lg bg-white/5 border border-white/10 px-3 py-2 text-sm flex-1",placeholder:"Nome do filtro",value:s,onChange:e=>d(e.target.value)}),(0,i.jsx)(c.z,{variant:"secondary",size:"sm",onClick:()=>{let e=m.safeParse(r);if(!e.success)return;let t={name:s||"Filtro salvo",filters:e.data};addSavedView(t),l(loadSavedViews()),d("")},children:"Salvar"})]}),(0,i.jsx)("div",{className:"flex flex-wrap gap-2 text-xs",children:a.map(e=>(0,i.jsx)("button",{className:"rounded-full border border-white/10 bg-white/5 px-3 py-1",onClick:()=>applyView(e),children:e.name},e.name))})]})]})}var p=r(6907),x=r(5025),h=r(6473),f=r(2182);function TimelinePage(){let[e,t]=(0,n.useState)({}),r=(0,o.mU)({correlationId:e.correlationId||void 0,decisionId:e.decisionId||void 0,domain:e.domain||void 0,kind:e.kind||void 0,types:e.types||void 0,from:e.from||void 0,to:e.to||void 0,limit:50}),a=(0,n.useMemo)(()=>{var e,t;return null!==(t=null===(e=r.data)||void 0===e?void 0:e.pages.flatMap(e=>e.items))&&void 0!==t?t:[]},[r.data]);return(0,i.jsx)(x.Z,{children:(0,i.jsx)(f.s,{roles:["member","admin"],children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("header",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-semibold",children:"Timeline"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Virtualizada, filtros salvos, export"})]}),(0,i.jsx)(c.z,{onClick:()=>(0,h.J)({filters:e,items:a}),variant:"secondary",size:"sm","aria-label":"Exportar timeline atual",children:"Export current view"})]}),(0,i.jsx)(TimelineFilters,{value:e,onChange:t}),(0,i.jsx)(p.j,{items:a,onLoadMore:()=>r.fetchNextPage(),hasNext:!!r.hasNextPage,filters:e})]})})})}},2182:function(e,t,r){"use strict";r.d(t,{s:function(){return AccessGuard}});var i=r(7573),n=r(7653),o=r(8116);function AccessGuard(e){let{roles:t,children:r}=e,[a,l]=(0,n.useState)(!1),[s,d]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{var e;let r=(0,o.u)(),i=(null!==(e=r.roles)&&void 0!==e?e:[]).map(e=>e.toLowerCase()),n=t.map(e=>e.toLowerCase());l(n.some(e=>i.includes(e))),d(!0)},[t]),s)?a?(0,i.jsx)(i.Fragment,{children:r}):(0,i.jsx)("div",{className:"p-6 text-center text-sm text-muted-foreground",children:"Access denied"}):null}},6907:function(e,t,r){"use strict";r.d(t,{j:function(){return TimelineList}});var i=r(7573),n=r(7653),o=r(2e3),a=r(6473);function TimelineList(e){let{items:t,onLoadMore:r,hasNext:a,filters:l}=e,s=(0,n.useRef)(null),d=(0,o.MG)({count:a?t.length+1:t.length,getScrollElement:()=>s.current,estimateSize:()=>96}),c=d.getVirtualItems();(0,n.useEffect)(()=>{let e=c[c.length-1];e&&e.index>=t.length-1&&a&&r()},[c,t.length,a,r]);let u=d.getVirtualItems();return(0,i.jsx)("div",{ref:s,"data-testid":"timeline-scroll",className:"h-[70vh] overflow-auto rounded-xl border border-white/10 bg-white/5",children:(0,i.jsx)("div",{style:{height:d.getTotalSize(),width:"100%",position:"relative"},children:u.map(e=>{let r=e.index>t.length-1,n=t[e.index];return(0,i.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:"translateY(".concat(e.start,"px)")},className:"px-3 py-2",children:r?(0,i.jsx)("div",{className:"text-sm text-muted-foreground",children:"Carregando..."}):(0,i.jsx)(TimelineCard,{item:n,filters:l})},e.key)})})})}let TimelineCard=e=>{let{item:t,filters:r}=e,copy=e=>e&&navigator.clipboard.writeText(e);return(0,i.jsxs)("article",{className:"rounded-lg border border-white/10 bg-white/5 p-4 flex items-start justify-between gap-3 hover:border-primary/40 transition",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm font-medium",children:t.summary}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:[t.kind," > ",t.domain," > ",new Date(t.timestamp).toLocaleString()]})]}),(0,i.jsxs)("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground items-end",children:[(0,i.jsx)("button",{onClick:()=>{var e;return copy(null!==(e=t.decisionId)&&void 0!==e?e:"")},className:"hover:text-foreground",children:"copy decision"}),(0,i.jsx)("button",{onClick:()=>{var e;return copy(null!==(e=t.correlationId)&&void 0!==e?e:"")},className:"hover:text-foreground",children:"copy correlation"}),(0,i.jsx)("button",{onClick:()=>{var e,i;return(0,a.J)({decisionId:null!==(e=t.decisionId)&&void 0!==e?e:void 0,correlationId:null!==(i=t.correlationId)&&void 0!==i?i:void 0,filters:r,items:[t]})},className:"hover:text-foreground",children:"export trace"})]})]})}},4806:function(e,t,r){"use strict";r.d(t,{Zb:function(){return Card},aY:function(){return CardContent},SZ:function(){return CardDescription},Ol:function(){return CardHeader},ll:function(){return CardTitle}});var i=r(7573),n=r(3883);let o={glass:"bg-white/5 border border-white/10 backdrop-blur-xl",panel:"bg-slate-900/70 border border-white/10",glow:"border border-white/10 bg-white/5 shadow-[0_0_0_1px_rgba(255,255,255,0.06)]"};function Card(e){let{children:t,className:r,variant:a="panel"}=e;return(0,i.jsx)("div",{className:(0,n.cn)("rounded-2xl shadow-lg",o[a],r),children:t})}function CardHeader(e){let{children:t,className:r}=e;return(0,i.jsx)("div",{className:(0,n.cn)("px-5 pt-5 pb-3 flex items-center justify-between gap-3",r),children:t})}function CardTitle(e){let{children:t,className:r}=e;return(0,i.jsx)("h3",{className:(0,n.cn)("text-lg font-semibold tracking-tight",r),children:t})}function CardDescription(e){let{children:t,className:r}=e;return(0,i.jsx)("p",{className:(0,n.cn)("text-sm text-muted-foreground",r),children:t})}function CardContent(e){let{children:t,className:r}=e;return(0,i.jsx)("div",{className:(0,n.cn)("px-5 pb-5",r),children:t})}},6473:function(e,t,r){"use strict";r.d(t,{J:function(){return exportTrace}});let exportTrace=e=>{let{decisionId:t,correlationId:r,filters:i,items:n,snapshot:o}=e,a={metadata:{exportedAt:new Date().toISOString(),decisionId:t,correlationId:r,filters:i,appVersion:"v0"},items:n,snapshot:o},l=t?"orion-trace-decision-".concat(t,".json"):r?"orion-trace-corr-".concat(r,".json"):"orion-trace-".concat(Date.now(),".json"),s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),d=URL.createObjectURL(s),c=document.createElement("a");c.href=d,c.download=l,c.click(),URL.revokeObjectURL(d)}}},function(e){e.O(0,[274,54,447,786,529,0,25,293,53,744],function(){return e(e.s=7285)}),_N_E=e.O()}]);